dependencies:
  pre:
    - case $CIRCLE_NODE_INDEX in 0) NODE_VERSION=4 ;; 1) NODE_VERSION=6 ;; 2) NODE_VERSION=8 ;; esac; nvm install $NODE_VERSION && nvm alias default $NODE_VERSION
  override:
    - if [ $CIRCLE_NODE_INDEX -ne 0 ]; then rm -rf node_modules; fi
    - npm install

test:
  override:
    - npm run ci-coverage-$(node -p 'process.versions.node.split(".")[0]'):
        parallel: true
        timeout: 1200
